# MeltingPoint Backend - Docker Compose
# Uso: docker compose up -d

services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: melting-point-api
    ports:
      - "8000:8000"
    env_file:
      - .env.production
    environment:
      - MODEL_PATH=/app/backend/models/model.joblib
      - CHEMPROP_MODEL_DIR=/app/backend/models/model_chemprop
      - TRAIN_DATASET_PATH=/app/data/raw/train_with_names.csv
      - TEST_DATASET_PATH=/app/data/raw/test_with_names.csv
      - TEST_PROCESSED_PATH=/app/data/processed/test_processed.csv
      - CHEMPROP_PREDICTIONS_PATH=/app/data/processed/test_chemprop_predictions.csv
      - USER_COMPOUNDS_PATH=/app/backend/data/user_compounds.csv
    volumes:
      # Persistir datos de usuario entre reinicios
      - user_data:/app/backend/data
    restart: unless-stopped
    # Limitar memoria para no tumbar la instancia
    deploy:
      resources:
        limits:
          memory: 900M

volumes:
  user_data:
